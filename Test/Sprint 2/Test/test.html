<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="" rel="stylesheet" />
    <title></title>
  </head>
  <body>
    <script>
      const url = "https://restcountries.com/v3.1/all";

      controller(url);

      function controller(url) {
        let worldArr = getDataAndCreateArray(url);

        console.log(worldArr);
      }

      function getDataAndCreateArray(link) {
        const worldArray = [];
        let posi = document.querySelector("body");
        const tab = document.createElement("table");
        fetch(link)
          .then((res) => {
            return res.json();
          })
          .then((data) => {
            for (i = 0; i < data.length; i++) {
              const country = {
                flag: data[i].flags.svg,
                name: data[i].name.common,
                capital: [],
                languages: [],
                population: data[i].population,
                continents: [],
                maps: data[i].maps.openStreetMaps,
                currenciesShort: [],
                currenciesLong: [],
                currenciesSymbol: [],
              };

              if (data[i].capital != undefined) {
                for (j = 0; j < data[i].capital.length; j++) {
                  country.capital.push(data[i].capital[j]);
                }
              } else {
                country.capital.push("N.A.");
              }
              for (j = 0; j < data[i].continents.length; j++) {
                country.continents.push(data[i].continents[j]);
              }

              if (data[i].languages != undefined) {
                const langArr = Object.values(data[i].languages);
                for (j = 0; j < Object.values(data[i].languages).length; j++) {
                  country.languages.push(Object.values(data[i].languages)[j]);
                }
              }

              if (data[i].currencies != undefined) {
                for (j = 0; j < Object.keys(data[i].currencies).length; j++) {
                  country.currenciesShort.push(
                    Object.keys(data[i].currencies)[j]
                  );

                  country.currenciesLong.push(
                    Object.values(data[i].currencies)[j].name
                  );
                  country.currenciesSymbol.push(
                    Object.values(data[i].currencies)[j].symbol
                  );
                }
              }

              worldArray.push(country);
              let row = document.createElement("tr");
              let rowTD1 = document.createElement("td");
              rowTD1.innerHTML = '<img src="${country.flag}">';
              let rowTD2 = document.createElement("td");
              rowTD2.innerHTML = country.name;
              rowTD2.innerHTML = '<img src="${country.flag}"';
              let rowTD3 = document.createElement("td");
              rowTD3.innerText = country.capital;
              let rowTD4 = document.createElement("td");
              rowTD4.innerText = country.languages;
              let rowTD5 = document.createElement("td");
              rowTD5.innerText = country.population;
              let rowTD6 = document.createElement("td");
              rowTD6.innerText = country.maps;
              let rowTD7 = document.createElement("td");
              rowTD7.innerText = country.currenciesShort;
              let rowTD8 = document.createElement("td");
              rowTD8.innerText = country.currenciesLong;
              let rowTD9 = document.createElement("td");
              rowTD9.innerText = country.currenciesSymbol;
              tab.appendChild(row);
              row.appendChild(rowTD1);
              row.appendChild(rowTD2);
              row.appendChild(rowTD3);
              row.appendChild(rowTD4);
              row.appendChild(rowTD5);
              row.appendChild(rowTD6);
              row.appendChild(rowTD7);
              row.appendChild(rowTD8);
              row.appendChild(rowTD9);
              posi.after(tab);
            }
          });

        console.log(worldArray);
        return worldArray;
      }
    </script>
  </body>
</html>
